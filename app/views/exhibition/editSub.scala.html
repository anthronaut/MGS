@(id: Long, parent_id: Long, values: Exhibition, myForm: Form[Exhibition], types: Seq[(String, String)])(implicit flash:Flash)



@import helper._
@implicitField = @{ FieldConstructor(fieldConstructor.f) }

@main(Messages("")) {

	@if(flash.get("success")) {<p class="alert alert-success">@Messages(flash.get("success").get)</p>}

	@if(myForm.hasErrors) {
        <div class="alert alert-danger">
            <p>@Messages("form.fixErrors")</p>

            @if(myForm.errors.size > 0) {
	            <ul>
	            @for((a) <- myForm.errors) {
	            <li>@Messages(a.message)</li>
	            }
	         	</ul>
         	}
        
            
        </div>
       
    
}

        <div class="row" >
			<div> 
				<ol class="breadcrumb">
				  <li><a href="@routes.Exhibitions.list">@Messages("exhibition.list.overview")</a></li>
				  <li><a href="@routes.Exhibitions.edit(parent_id)">@Messages("cat.overview")</a></li>
				  <li>@Messages("exhibition.title.edit")</li>
				</ol>
			</div>

		</div>
		

		<div class="row">
			<div class="col-md-12">
				<form method="post" class="form-horizontal" role="form" accept-charset="UTF-8" action="@routes.Exhibitions.updateSub(id, parent_id)">
					@inputText(myForm("name"), '_label -> "name_cat")
					@inputText(myForm("name_en"), '_label -> "name_cat_en")
					@inputText(myForm("number"))
					@select(myForm("type_id"), types, '_class-> "disbled")
					@textarea(myForm("comment"))
					@textarea(myForm("comment_en"))
						<div class="col-md-3">
					</div>
						<div class="actions col-md-9">
						<input type="submit" class="btn btn-primary" value="@if(id>0){@Messages("edit")}else{@Messages("add")}">
							<a class="btn btn-info" href="@if(values.type_id.isDefined){@routes.Application.detail(id)}else{@routes.Application.submenu(id)}" target="_blank">
								@Messages("preview")
							</a>
							<a href="@routes.Exhibitions.edit(parent_id)" class="btn btn-default">
								@Messages("back")
							</a>
							@if(id>0){
							<a href="@routes.Exhibitions.delete(id)" class="btn btn-danger">
								Messages("delete")
							</a>
							}
						</div>	
				</form>
			</div>	
		</div>
		
@if(values.type_id.isDefined && (values.type_id.get==7)){
test
}

@if(values.type_id.isDefined && (values.type_id.get==4 || values.type_id.get==5)){
<div class="row">
	<div class="col-md-6">
	<h2>@Messages("file")</h2>

	@form(action = routes.Exhibitions.insertFile(id, parent_id, 1), 'enctype -> "multipart/form-data") {

		<input type="file" name="file">
		<input class="btn btn-primary" type="submit" value="@Messages("add")">

		@if(values.file.isDefined){
			<a class="btn btn-danger" href="@routes.Exhibitions.deleteFile(id, parent_id, 1)">@Messages("delete")</a>
		}
	}

	@* show form for background image only for video *@
	@if(values.type_id.get==5){
		<h2>@Messages("file.associated")</h2>

		@form(action = routes.Exhibitions.insertFile(id, parent_id, 2), 'enctype -> "multipart/form-data") {

			<input type="file" name="file">
			<input class="btn btn-primary" type="submit" value="@Messages("add")">

			@if(values.file2.isDefined){
				<a class="btn btn-danger" href="@routes.Exhibitions.deleteFile(id, parent_id, 2)">@Messages("delete")</a>
			}
		}
	}

	</div>

	
	<div class="col-md-6">
	<h2>@Messages("preview")</h2>

	@if(values.type_id.isDefined && values.file.isDefined){
		@values.type_id.get match{
			case 1 => {@Html(values.comment.getOrElse(""))}
			case 3 => {<img class="col-md-12" src="@values.file.get">}
			case 4 => {
				<audio controls @if(values.file2.isDefined){poster="@values.file2.get"}>
					<source src="@values.file.get" type="audio/mpeg">
					Your browser does not support the audio element.
				</audio>
			}

			case 5 => {
				<video  controls @if(values.file2.isDefined){poster="@values.file2.get"}>
					<source src="@values.file.get" type="video/mp4">
					Your browser does not support the video tag.
				</video>
			}
		}
	}else{
		@Messages("no_preview")
	}

	</div>
</div>
}


@if(values.type_id.isEmpty){
<div class="row">
	<div class="col-md-6">
	<h2>@Messages("file")</h2>

	@form(action = routes.Exhibitions.insertFile(id, parent_id, 2), 'enctype -> "multipart/form-data") {

		<input type="file" name="file">
		<input class="btn btn-primary" type="submit" value="@Messages("add")">

		@if(values.file2.isDefined){
			<a class="btn btn-danger" href="@routes.Exhibitions.deleteFile(id, parent_id, 2)">@Messages("delete")</a>
		}
	}

	
	<div class="col-md-6">
	<h2>@Messages("preview")</h2>

	@if(values.file2.isDefined){

			<img class="col-md-12" src="/detail/@values.file2.get">
			
	}else{
		@Messages("no_preview")
	}

	</div>
</div>
}



@if(values.type_id.isDefined && values.type_id.get==3){
<div class="row">
	<div class="col-md-12">
	<h2>@Messages("file")</h2>
	
	



		<div id="file-uploader">

		    <noscript>
		        <p>Please enable JavaScript to use file uploader.</p>
		        <!-- or put a simple form for upload here -->
		    </noscript>
			
			<script src="@routes.Assets.at("js/fileuploader.js")"></script>
			<script>
				function createUploader(){
					var uploader = new qq.FileUploader({
						element: document.getElementById('file-uploader'),
						action: '/admin/@values.id.get/upload',
						debug: true,
						text: {
							uploadButton: '<div><i class="icon-upload icon-white"></i> Test me now and upload a file</div>'
						},
						template: '<div class="qq-uploader span12">' +
							'<pre class="qq-upload-drop-area span12"><span>Drag file here</span></pre>' +
							'<div class="qq-upload-button btn btn-primary" style="width: auto;">@Messages("upload_file")</div>' +
							'<span class="qq-drop-processing"><span>{dropProcessingText}</span><span class="qq-drop-processing-spinner"></span></span>' +
							'<ul class="qq-upload-list" style="margin-top: 10px; text-align: center;"></ul>' +
							'</div>',
					});
				}

				// in your app create uploader as soon as the DOM is ready
				// don't wait for the window to load
				window.onload = createUploader;
			</script>

		</div>
		

	</div>
</div>

<!--- Insert single gallery slide -->

<div class="row">
		<div class="col-md-12">

				<div class="actions col-md-offset-3 col-md-9">
			<form method="post" class="form-horizontal" role="form" action="@routes.Galleries.insert(id, parent_id)">
					<input type="submit" class="btn btn-primary" value="@Messages("add")">
				</div>
			</form>
		</div>
	</div>
<!-- end insert gallery slide -->
		

<div class="row">
	
	<div class="col-md-12">
	<h2>@Messages("preview")</h2>
		

	

	@defining(Exhibition.Gallery.list(values.id.get)){exh=>
		@exh.map{pic =>
<div class="row" style="outline: 1px dotted black">
	
				<div class="col-md-2">
				<a href="@pic.filename"  class="thumbnail"><img src="/data-museum/@(pic.filename)" id="@pic.id" alt="@pic.id" /></a>
										<p>
						@if(pic.position>1){
							<a class ="btn btn-primary" href="@routes.Galleries.move(pic.id.get, id, parent_id, true)"><span class="glyphicon glyphicon-arrow-up"></span></a>}
						@if(pic.position< exh.size){
							<a class ="btn btn-primary" href="@routes.Galleries.move(pic.id.get, id, parent_id, false)">
								<span class="glyphicon glyphicon-arrow-down"></span>
							</a>
						}
						<a class ="btn btn-danger" href="@routes.Exhibitions.deleteGallery(pic.id.get, values.id.get, parent_id)">@Messages("delete")</a>
						</p>
										
					</div>
					<div class="col-md-10">			    					
					<div class="caption">


<!--							<span class="caption2"><span class="caption3">@pic.caption.getOrElse("")</span></span>
-->							<span class="captionEdit">
								
								<form id="editCaption" action="@routes.Galleries.update(pic.id.get)" method="post">
								<textarea style="width: 100%" rows="25" name="caption">@pic.caption.getOrElse("")</textarea>
								<input type="submit" class="btn btn-primary" value="@Messages("gallery.send")">
								</form>
							</span>

						<p>
							
						</p>


					</div>
					</div>

			
</div>
		}
	}
			


	</div>
</div>


}


@if(values.type_id.isDefined && List(1,3,4,5).contains(values.type_id.get)){
<script src="@routes.Assets.at("js/tinymce/tiny_mce.js")"></script>
<script src="@routes.Assets.at("js/tinymce/useTinyMCE.js")"></script>   
}


@if(values.type_id.isDefined && values.type_id.get==3){
<script>

$(document).ready(function() {
	

	//
	//$("a.captionToEdit").click(function(){
	//
	//	$(this).parent().toggle()
	//	$(this).parent().parent().children('span.captionEdit').toggle()
	//	event.preventDefault()
	//
	//})


	// support for UTF-8
	$("form#editCaption").submit(function(){

		var dataSerialize = $(this).serializeArray()
		var elem = $(this).parent().parent().children('span.caption2')


		$.ajax({
        type: 'POST',
        url: $(this).attr('action'),
        data: dataSerialize,
        dataType: 'json',
        success: function(result) {
          console.log('revoke response: ' + result.status +" "+ result.caption)
          elem.children('span.caption3').text(result.caption)
        },
        error: function(e) {
          console.log(e.status)
        }
      })

		// toggle back
//      elem.toggle()
//		$(this).parent().toggle()

		event.preventDefault()
	})


})
	
</script>
}

}

